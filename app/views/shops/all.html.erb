<%= render partial: './header.html.erb' %>

<!-- Breadcrumbs -->
<div class="breadcrumbs"  id="turbolinks_top">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <div class="bread-inner">
          <ul class="bread-list">
            <li><%= link_to(controller: 'home', action: 'index') do %>Главная<i class="ti-arrow-right"></i><% end %></li>
            <li class="active"><%= link_to(controller: 'shops', action: 'all') do %>Магазины<% end %></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- End Breadcrumbs -->





<!-- Product Style -->
<section class="product-area shop-sidebar shop section">
  <div class="container">
    <div class="shop-name"><h2>Магазины</h2></div>
    <div class="row">
      <div class="col-lg-3 col-md-4 col-12">
        <div class="shop-sidebar">
          <!-- Single Widget -->
          <!--<div class="single-widget category">
            <h3 class="title">Categories</h3>
            <ul class="categor-list">
              <li><a href="#">T-shirts</a></li>
              <li><a href="#">jacket</a></li>
              <li><a href="#">jeans</a></li>
              <li><a href="#">sweatshirts</a></li>
              <li><a href="#">trousers</a></li>
              <li><a href="#">kitwears</a></li>
              <li><a href="#">accessories</a></li>
            </ul>
          </div>-->
          <!--/ End Single Widget -->
          <!-- Shop By Price -->
          <!--<div class="single-widget range">
            <h3 class="title">Shop by Price</h3>
            <div class="price-filter">
              <div class="price-filter-inner">
                <div id="slider-range"></div>
                <div class="price_slider_amount">
                  <div class="label-input">
                    <span>Range:</span><input type="text" id="amount" name="price" placeholder="Add Your Price"/>
                  </div>
                </div>
              </div>
            </div>
            <ul class="check-box-list">
              <li>
                <label class="checkbox-inline" for="1"><input name="news" id="1" type="checkbox">$20 - $50<span class="count">(3)</span></label>
              </li>
              <li>
                <label class="checkbox-inline" for="2"><input name="news" id="2" type="checkbox">$50 - $100<span class="count">(5)</span></label>
              </li>
              <li>
                <label class="checkbox-inline" for="3"><input name="news" id="3" type="checkbox">$100 - $250<span class="count">(8)</span></label>
              </li>
            </ul>
          </div>-->
          <%= form_with :url => url_for(controller:'shops', action: 'all'), method: "get", data: {'turbolinks-form'=>'true', 'scrollToTop'=>true} do %>
          <div class = "single-widget">
            <h3 class = "title">Поиск по рейтингу</h3>
            <div class="quickview-ratting post_review_ratting set_rating">
                      <span class="post_review_ratting_el <%= params[:mark] and params[:mark].to_i >=5 ? 'ratting_star': '' %>">☆</span>
                      <span class="post_review_ratting_el <%= params[:mark] and params[:mark].to_i >=4 ? 'ratting_star': '' %>">☆</span>
                      <span class="post_review_ratting_el <%= params[:mark] and params[:mark].to_i >=3 ? 'ratting_star': '' %>">☆</span>
                      <span class="post_review_ratting_el <%= params[:mark] and params[:mark].to_i >=2 ? 'ratting_star': '' %>">☆</span>
                      <span class="post_review_ratting_el <%= params[:mark] and params[:mark].to_i >=1 ? 'ratting_star': '' %>" %>☆</span>

            </div>
              <input type="number" name="mark" class="ratting_inp" style="display: none" value="0">

            <div class="form-group button" style="margin-top: 20px;">
              <button type="submit" class="btn" data-turbolinks_scrolltop="true">Найти</button>
            </div>
          </div>

          <!--/ End Shop By Price -->
          <!-- Single Widget -->
          <%= render partial: './best.html.erb', locals:{:cat_id=> @category.try(:subtree)  } %>
          <!--/ End Single Widget -->
          <!-- Single Widget -->
          <!--<div class="single-widget category">
            <h3 class="title">Manufacturers</h3>
            <ul class="categor-list">
              <li><a href="#">Forever</a></li>
              <li><a href="#">giordano</a></li>
              <li><a href="#">abercrombie</a></li>
              <li><a href="#">ecko united</a></li>
              <li><a href="#">zara</a></li>
            </ul>
          </di-->
          <!--/ End Single Widget -->
        </div>
      </div>

      <div class="col-lg-9 col-md-8 col-12 row-fix2">
        <div class="">
          <div class="col-12 row-fix3">
            <!-- Shop Top -->
            <div class="shop-top">
              <div class="shop-shorter">
                <!--<div class="single-shorter">
                  <label>Show :</label>
                  <select>
                    <option selected="selected">09</option>
                    <option>15</option>
                    <option>25</option>
                    <option>30</option>
                  </select>
                </div>-->

                <div class="single-shorter">
                  <label>Сортировать :</label>
                  <select onchange = "sort_handler(this)" name="order">
                    <option <%= !params[:order] || params[:order] == 'mark' ? 'selected': '' %> value="mark">Рейтинг</option>
                    <option <%= params[:order] == 'name' ? 'selected': '' %> value="name">Название</option>
                    <option <%= params[:order] == 'qty' ? 'selected': '' %> value="qty">Количество товаров</option>

                  </select>
                </div>
              </div>
                <!--
              <ul class="view-mode">
                <li class="active"><a href="shop-grid.html"><i class="fa fa-th-large"></i></a></li>
                <li><a href="shop-list.html"><i class="fa fa-th-list"></i></a></li>
              </ul>-->
            </div>
            <!--/ End Shop Top -->
          </div>
        </div>
          <% end %>
        <div class="row" style="width: 100%; margin: 0; ">
					<% @shops.each do |shop| %>
						<%= link_to(controller: 'shops', action: 'index', id: shop.id) do || %>
          <div class="col-lg-4 col-xs-6 col-md-6 col-sm-6 single_shop_container">
            <div class="left-shop-inform-container left-shop-inform-container_second" style="height: 100%">
	          <div class="left-shop-inform left-shop-inform_second">
	            <div class="logo-shop">
                <% if shop.main_photo.attached? %>
                  <%= image_tag shop.main_photo, class: 'logo-shop' %>
                <% else %>
                  <%= image_tag url_for('shop.png'), class: 'logo-shop' %>
                <% end %>
	            </div>
	            <div class="data-shop">

								<div>
									<div class="name-shop">
										<h5 style="word-break: break-all"><%= shop.name %></h5>
									</div>
									<div class="rating-shop">
										<ul class="reviews">
											<% (1..shop.mark.round()).each do |i| %>
												<li class="yellow"><i class="ti-star"></i></li>
											<% end %>
											<% (shop.mark.round()..4).each do |i| %>
												<li><i class="ti-star"></i></li>
											<% end %>
										</ul>
										<a class="reviews-shop" href="#">Отзывов <%= shop.posts.count %></a>
									</div>
								</div>

	              <!--<div class="location-shop">
	                <p>Расположение</p>
	                <p class="data">Таганрог</p>
	              </div>
                <p>Надежный продавец: <i class="fa fa-check" aria-hidden="true"></i></p> -->

	              <div class="categories_shop" style="padding-top: 25px">
	                <p>Категории магазина:</p>
	                <div class="categories" >
                    <% if JSON.parse(shop.top_cat).any? %>
                    <% JSON.parse(shop.top_cat).each do |a| %>
						          <p><%=  Category.find(a).name %></p>
					        <% end %>
                      <% else %>
                    <p>У данного магазина нет товаров</p>
                      <% end %>
	                </div>
	              </div>

	            </div>
	          </div>
        	</div>
          </div>
						<% end %>
          <%  end %>
        </div>
      </div>
    </div>
    </div>
  </div>
</section>
<!--/ End Product Style 1  -->







